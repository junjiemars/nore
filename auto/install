

NM_BIN_PATH=${NM_PREFIX%/}/${NM_BIN_PATH%/}
NM_LIB_PATH=${NM_PREFIX%/}/${NM_LIB_PATH%/}
NM_INC_PATH=${NM_PREFIX%/}/${NM_INC_PATH%/}
NM_ETC_PATH=${NM_PREFIX%/}/${NM_ETC_PATH%/}
NM_LOG_PATH=${NM_PREFIX%/}/${NM_LOG_PATH%/}
NM_PID_PATH=${NM_PREFIX%/}/${NM_PID_PATH%/}


# append install target

cat << END >> $NM_MAKEFILE

#---------------------------------------


install: build $NM_BIN_PATH $NM_LIB_PATH $NM_INC_PATH $NM_ETC_PATH
	\$(call cp-if, $NM_OUT/bin, $NM_BIN_PATH/)
	\$(call cp-if, $NM_OUT/lib, $NM_LIB_PATH/)
	\$(call cp-if, $NM_OUT/inc, $NM_INC_PATH/)
	\$(call cp-if, $NM_OUT/etc, $NM_ETC_PATH/)


$NM_BIN_PATH $NM_LIB_PATH $NM_INC_PATH $NM_ETC_PATH:
	\$(call mkdir-if, $NM_BIN_PATH)
	\$(call mkdir-if, $NM_LIB_PATH)
	\$(call mkdir-if, $NM_INC_PATH)
	\$(call mkdir-if, $NM_ETC_PATH)
	\$(call mkdir-if, $NM_LOG_PATH)


mkdir-if = \$(if \$(wildcard \$1),,mkdir -p \$1)
cp-if = \$(foreach f,\$(wildcard \$1/*),\$(shell cp -r \$(f) \$2))



END



# create Makefile

cat << END >> Makefile

build:
	\$(MAKE) -f $NM_MAKEFILE

install: 
	\$(MAKE) -f $NM_MAKEFILE install

END


