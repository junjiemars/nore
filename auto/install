

NM_BIN_PATH=${NM_PREFIX%/}/${NM_BIN_PATH%/}
NM_LIB_PATH=${NM_PREFIX%/}/${NM_LIB_PATH%/}
NM_CONF_PATH=${NM_PREFIX%/}/${NM_CONF_PATH%/}
NM_LOG_PATH=${NM_PREFIX%/}/${NM_LOG_PATH%/}
NM_INC_PATH=${NM_PREFIX%/}/${NM_INC_PATH%/}
NM_PID_PATH=${NM_PREFIX%/}/${NM_PID_PATH%/}


# append install target

cat << END >> $NM_MAKEFILE

#---------------------------------------


install: build $NM_BIN_PATH $NM_LIB_PATH $NM_CONF_PATH $NM_INC_PATH
	\$(call cp-if, $NM_OBJS/bin, $NM_BIN_PATH/)
	\$(call cp-if, $NM_OBJS/lib, $NM_LIB_PATH/)
	\$(call cp-if, $NM_OBJS/conf, $NM_CONF_PATH/)
	\$(call cp-if, $NM_OBJS/inc, $NM_INC_PATH/)


$NM_BIN_PATH $NM_LIB_PATH $NM_CONF_PATH $NM_INC_PATH:
	\$(call mkdir-if, $NM_BIN_PATH)
	\$(call mkdir-if, $NM_LIB_PATH)
	\$(call mkdir-if, $NM_CONF_PATH)
	\$(call mkdir-if, $NM_INC_PATH)
	\$(call mkdir-if, $NM_LOG_PATH)


mkdir-if = \$(if \$(wildcard \$1),,mkdir -p \$1)
cp-if = \$(foreach f,\$(wildcard \$1/*),\$(shell cp \$(f) \$2))



END



# create Makefile

cat << END >> Makefile

build:
	\$(MAKE) -f $NM_MAKEFILE

install: 
	\$(MAKE) -f $NM_MAKEFILE install

END


