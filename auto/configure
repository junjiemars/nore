#!/bin/bash

LC_ALL=C
export LC_ALL

NM_HOME=$(dirname `dirname $0`)
NM_HOME="${NM_HOME%/}/"

. ${NM_HOME}auto/options
. ${NM_HOME}auto/init


test -d "$NM_OUT" || mkdir -p $NM_OUT

echo > $NM_AUTOCONF_ERR


cat << END > $NM_AUTO_H

#define NM_CONFIGURE "$NM_CONFIGURE"
END


if test -z "$NM_PLATFORM"; then
  echo "checking for OS"
  
  NM_SYSTEM=`uname -s 2>/dev/null`
  NM_RELEASE=`uname -r 2>/dev/null`
  NM_MACHINE=`uname -m 2>/dev/null`
  
  echo " + $NM_SYSTEM $NM_RELEASE $NM_MACHINE"
  
	case $NM_SYSTEM in
		MSYS_NT-*)
			NM_RELEASE=${NM_SYSTEM:8}
			NM_SYSTEM=WinNT
		;;
		MINGW??_NT-*)
			NM_RELEASE=${NM_SYSTEM:11}
			NM_SYSTEM=WinNT
		;;
	esac
		
  NM_PLATFORM="$NM_SYSTEM:$NM_RELEASE:$NM_MACHINE";
  
else
  echo "building for $NM_PLATFORM"
  NM_SYSTEM=$NM_PLATFORM
fi



. ${NM_HOME}auto/cc/conf

. ${NM_HOME}auto/os/conf


case ".$NM_PREFIX" in
	.)
		if [ -n "$OPT_RUN" ]; then
			NM_PREFIX="$OPT_RUN"
		else
			NM_PREFIX=/opt/run
		fi
    have=NM_PREFIX value="\"$NM_PREFIX/\"" . ${NM_HOME}auto/define
	;;

	.*)
    have=NM_PREFIX value="\"$NM_PREFIX/\"" . ${NM_HOME}auto/define
	;;

esac


. ${NM_HOME}auto/make

. ${NM_HOME}auto/install

. ${NM_HOME}auto/summary
