#!/bin/bash
#------------------------------------------------
# target: configuration script of Nore	
# url: https://github.com/junjiemars/nore.git
# author: junjiemars@gmail.com
#------------------------------------------------

LC_ALL=C
export LC_ALL

NORE_ROOT=$(dirname `dirname $0`)
NORE_ROOT="${NORE_ROOT%/}"

. ${NORE_ROOT}/auto/options
. ${NORE_ROOT}/auto/init


test -d "$NM_OUT" || mkdir -p $NM_OUT

echo > $NM_AUTOCONF_ERR


cat << END > $NM_AUTO_H
/* ${NM_AUTO_H}
 *
 * ${gen_by_nore}
 *
*/

#define NM_CONFIGURE "$NM_CONFIGURE"
END


. ${NORE_ROOT}/auto/symbol
if [ -n "$NM_SYMBOL_FILE" ]; then
	if [ -f "$NM_SYMBOL_FILE" ]; then
		load_symbol_table "$NM_SYMBOL_FILE"
	else
		dump_symbol_table "$NM_SYMBOL_FILE"
	fi
fi


if test -z "$NM_PLATFORM"; then
  echo "checking for OS"
  
  NM_SYSTEM=`uname -s 2>/dev/null`
  NM_RELEASE=`uname -r 2>/dev/null`
  NM_MACHINE=`uname -m 2>/dev/null`
  
  echo " + $NM_SYSTEM $NM_RELEASE $NM_MACHINE"
  
	case $NM_SYSTEM in
		MSYS_NT-*)
			NM_RELEASE=${NM_SYSTEM:8}
			NM_SYSTEM=WinNT
		;;
		MINGW??_NT-*)
			NM_RELEASE=${NM_SYSTEM:11}
			NM_SYSTEM=WinNT
		;;
	esac
		
  NM_PLATFORM="$NM_SYSTEM-$NM_RELEASE-$NM_MACHINE";
  
else
  echo "building for $NM_PLATFORM"
  NM_SYSTEM=$NM_PLATFORM
fi



. ${NORE_ROOT}/auto/cc/conf

. ${NORE_ROOT}/auto/os/conf


case ".$NM_PREFIX" in
	.)
		case "$NM_SYSTEM" in
			Darwin) NM_PREFIX="/opt/local" ;;
			Linux)  NM_PREFIX="/usr/local" ;;
		esac
    have=NM_PREFIX value="\"$NM_PREFIX/\"" . ${NORE_ROOT}/auto/define
	;;

	.*)
    have=NM_PREFIX value="\"$NM_PREFIX/\"" . ${NORE_ROOT}/auto/define
	;;

esac


. ${NORE_ROOT}/auto/make

. ${NORE_ROOT}/auto/install

. ${NORE_ROOT}/auto/summary
